<@
var test="bla";

var count=request.Parameters().Parameter("count").join();
if (count==="" || count===undefined) {
    count=1;
} 
for(var i=0;i<count;i++) {
    print("<h2>",(i+1),"</h2>");
try{
    var r=dbms.QuerySettings({alias:"psg",query:"select *,@@VAL@@::int as col from test.tbltest limit 1",script:script,success:function(r){
        @><table><@
        r.OnColumns=function(rdr) {
            @><tr><@
            rdr.Columns().forEach(function(val){
                @><th><@print(val);@></th><@
            });
            @></tr><@
        };
        r.OnRow=function(rdr,rn) {
            @><tr><@
                rdr.Data().forEach(function(val){
                @><td><@print(rn,":",val);@></td><@
            });
            @></tr><@
        };
        r.OnValidData=function(rdr,rn) {
            var datamp=rdr.DataMap();
            return (datamp["name"]==="bla");
        };
        r.OnFinalize=function(){
            @></table><@
        };
    },"error":function(err){
        @><tr><th><@print(err.Error());@></th></tr><@
    },args:{"VAL":42}});
    while(r.Next());
    r.Close();
}catch(e){
    println(e.message);
}
}
@>